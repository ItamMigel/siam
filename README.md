# Задача по выявлению паттернов давления в нефтегазовых скважинах

## Описание задачи

В нефтегазовой отрасли стационарные датчики непрерывно собирают данные о давлении в добывающих скважинах. Из-за большого количества скважин и огромных объёмов данных ручной анализ становится неэффективным.

В этом соревновании необходимо разработать алгоритм, который автоматически выделяет два ключевых паттерна во временных рядах давления:

- **КВД (Кривая Восстановления Давления, Recovery)** – характеризует процесс остановки работы скважины.
- **КПД (Кривая Падения Давления, Drop)** – характеризует процесс запуска работы скважины.

---

## Запуск решения

1. Перейдите в папку проекта `VOST_0.686_with_argparse_final`.
2. Установите зависимости:

```bash
pip install -r requirements.txt
```

3. Используйте Python версии `3.12.7` для достижения наилучшего результата.

4. Запустите скрипт конвертации данных в новый формат:

```bash
python3 folder_to_csv.py --input_folder <path_to_folder_with_old_format> --new_folder_name <new_folder_name>
```

5. Запустите основной скрипт для обучения и предсказания:

```bash
python3 vost_ultimate.py --test_folder_path <path_to_test_folder>
```

Модель обучается и дает предсказание менее чем за **35 секунд** на 100 тестовых файлах.

---

## Пайплайн решения

**Этапы работы алгоритма:**

1. Берёт тренировочные данные из файла `vost_clear_razmetka.csv`.
2. Скрипт поиска монотонных участков `segmentation.py` выявляет потенциальные КВД и КПД.
3. Скрипт `features.py` генерирует признаки (фичи) для обучения моделей.
4. Две отдельные модели для Drop и Recovery, каждая использует ансамбль моделей: **LightGBM**, **CatBoost**, **XGBoost**.

---

## Наши преимущества

- **Алгоритм поиска монотонно возрастающих и убывающих функций адаптируется под все возможные размеры паттернов**

Алгоритм выделяет участки монотонного поведения давления в зависимости от времени, где давление либо постоянно растёт, либо падает, при этом игнорируя аномальные выбросы. 
Для уменьшения шума применияется медианный фильтр. Потом точки, сильно отличающиеся от сглаженных значений, исключаются. Последовательно анализируются точки, чтобы найти непрерывные участки возрастания или убывания. Во время поиска таких участков, также настривается допустимый коридор для шума, что не обрывать отрезки из-за каких то погрешностей приборов, или небольших шумов. Сегмент сохраняется, если он достаточно длинный и содержит точки с высоким давлением.
Возвращается словарь с найденными участками, указаны время  начала и конца каждого сегмента, а также файл, в котором этот участок наблюдался, для удобства использования алгоритма по папке.

- **Ручная разметка части основного датасета**.

- **Генерация фичей**

На вход функции подается выявленный с помощью алгоритма отрезок, графически он представляет из себя кривую похожую на КВД или КПД. Cоздаются признаки которые извлекают максимум полезной информации из этих данных: cреднее значение давления, коэффициент асимметрии распределения давления,
дисперсия и стандартное отклонение изменений давления, количество экстремумов давления, средний угол наклона между соседними точками давления и так далее. Эти признаки обрабатывают различные аспекты данных: от статистических характеристик и изменений во времени, до частотных и геометрических характеристик. Это позволяет создавать богатую и информативную информацию для дальнейшего анализа или обучения моделей машинного обучения.

Эти признаки покрывают статистические, временные, частотные и геометрические характеристики данных.

- **Проверка альтернативного подхода с компьютерным зрением** (выбор сделан в пользу классических алгоритмов для оптимального баланса скорости и точности).

- **Возможность расширения**: решение легко позволяет интегрировать новые данные.

---

## Структура репозитория

```plaintext
│── AutoGluonModels/                                # Модели AutoGluon
│── catboost_info/                                  # Информация о CatBoost
│── marked_data/                                    # Основной датасэт от организаторов
│── razmetka_files/                                 # Файлы разметки
│   ├── submission_clear.csv                        # Шаблон сабмита
│   ├── vost_clear_razmetka.csv                     # Наша ручная разметка
│── test_files/                                     # Тестовые файлы
│── utils/                                          # Утилиты и функции
│   ├── features.py                                 # Генерация фичей
│   ├── razmetka.ipynb                              # Ноутбук для ручной разметки
│   ├── make_razmetka_by_adding_features.py         # Добавление фичей в разметку
│   ├── segmentation.py                             # Алгоритм поиска монотонных участков
│   ├── submission.py                               # Формирование сабмита
│   ├── vost_generate_predict.py                    # Генерация предсказаний
│   └── __pycache__/                                # Кэш Python
├── fix.csv                                         # Файл для отладки
├── folder_to_csv.py                                # Алгоритм конвертации из формата временных рядов организаторов в .csv формат с колонками time и pressure
├── requirements.txt                                # Зависимости
├── VOST_SUBMISSION_ultim_vost_clear_razmetka.csv   # Итоговый сабмит
├── vost_ultimate_feature_importance.py             # Важность фичей
├── vost_ultimate.py                                # Основной скрипт
└── README.md                                       # Документация
